<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My TeleKit Pro App 1</title>
    <link rel="stylesheet" href="telekit/telekit.css">
    <script src="https://telegram.org/js/telegram-web-app.js?59"></script>
</head>
<body>
    <div id="drawer-container"></div>
    <div id="app"></div>

    <!-- TeleKit Framework -->
    <script src="telekit/telekit.js"></script>
    <script src="telekit/components.js"></script>

    <!-- App Pages -->
    <script src="pages/home.js"></script>
    <script src="pages/profile.js"></script>
	<script src="pages/settings.js"></script> <!-- Add new page -->
    <script src="pages/about.js"></script>    <!-- Add new page -->

    <!-- App Initialization -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
		
            // Initialize TeleKit with a global state and API URL
            const TK = new TeleKit({
				// CHOOSE YOUR NAVIGATION STYLE HERE: 'drawer' or 'bar'
                navStyle: 'drawer', 
				
                // Your Bot's backend API URL
                apiBaseUrl: 'https://your-backend.com/api', 
                // Initial global state
                state: {
                    userProfile: {
                        name: 'Guest',
                        email: 'Not set'
                    },
                    items: ['Item 1', 'Item 2', 'Item 3'],
					
					// --- SETTINGS OBJECT --- 
					settings: {
                        enableNotifications: true,  // For TK_Toggle
                        showPreviews: false,        // For TK_Checkbox
                        language: 'en'              // For TK_Select
                    }
                }
            });

            // Make TK globally accessible
            window.TK = TK;

            // Register components
            registerTeleKitComponents(TK);

            // Register pages
            TK.addPage('home', HomePage);
            TK.addPage('profile', ProfilePage);
            TK.addPage('settings', SettingsPage);
            TK.addPage('about', AboutPage);
			
            // Set the initial page
            TK.navigateTo('home');
			
            // This function runs once when the app starts up
            function loadInitialData() {
                TK.cloudStorage.getItem('user_profile', (err, profileJson) => {
                    if (err) {
                        console.error('Failed to load initial data:', err);
                        return;
                    }
                    if (profileJson) {
                        try {
                            const savedProfile = JSON.parse(profileJson);
                            console.log('Initial data loaded from cloud:', savedProfile);
                            // Silently update the state without an alert
                            TK.setState({ userProfile: savedProfile });
                        } catch (e) {
                            console.error('Failed to parse initial data:', e);
                        }
                    } else {
                        console.log('No initial data found in cloud.');
                    }
                });
            }

            // Run the loader function
            loadInitialData();

        });
    </script>
</body>
</html>